-- 1
-- Top ten users with more audio time listened
SELECT user_id, COUNT(seconds) as Total_time
FROM audiobook_plays
GROUP BY user_id
ORDER BY Total_time DESC
LIMIT 10;

-- Top ten audiobooks with more audio time listened
SELECT audiobook_id, COUNT(seconds) as Total_time
FROM audiobook_plays
GROUP BY audiobook_id
ORDER BY Total_time DESC
LIMIT 10;

-- 2
-- Dates between audiobook_plays table
SELECT MIN(created_at), MAX(created_at)
FROM audiobook_plays
LIMIT 10;

-- Weekly Unique Active Users
SELECT date_part('year', created_at::date) as Year,
    date_part('week', created_at::date) as Weekly,
    COUNT(DISTINCT(user_id)) as Users
FROM audiobook_plays
GROUP BY Year, Weekly
ORDER BY Year, Weekly;

-- 3 Falta terminar
-- Week over Week retention rato of active user
WITH WAU (Year, Weekly, User_id)
AS (
    SELECT date_part('year', created_at::date),
    date_part('week', created_at::date),
    user_id
    FROM audiobook_plays
)
SELECT WAU.Year, WAU. Weekly, WAU.User_id
FROM WAU
LIMIT 10;

-- 4 
-- Average Hours_played_last_30_days
WITH dummy_query (last_date)
AS (
    SELECT MAX(created_at)
    FROM audiobook_plays
)
SELECT user_id, ROUND(AVG(seconds/60),2) AS Hours_played_last_30_days
FROM audiobook_plays, dummy_query
WHERE created_at > (dummy_query.last_date - interval '30 days')
GROUP BY user_id
ORDER BY Hours_played_last_30_days DESC

-- 5
-- Month over month growth (%)





--Querys for user-audiobook
SELECT *
FROM audiobook
